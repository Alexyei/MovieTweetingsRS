# Структруа проекта

## Client

## Server

### seeders

Сеятели заполняют БД исходными данными

| Название                      | Описание                                                                                                                                                                                                                                                                             | Изменения в БД                                                                                                                                           |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| *populate_movies*             | Загружает сведения о фильмах из файла на github                                                                                                                                                                                                                                      | Перезаписывает таблицы `Movie` и `Genre`.                                                                                                                |
| *populate_ratings*            | Загружает оценки пользователей из файла на github. Оценки в диапазоне [0,10]. 0 оценки заменяются на 0.00001                                                                                                                                                                         | Перезаписывает таблицу `Rating`. При необходимости создаёт пользователей (`User`). **Таблица `Movie` уже должна быть заполнена!**                        |
| *populate_movies_description* | Загружает описания фильмов и их постеры используя *api.themoviedb.org*. **Client_api доступно только через VPN! Поэтому на выполнение "посева" требуется много времени (прогресс при остановке сохраняется). Также необходимо предварительно зарегистрироваться в этом Client_api.** | **Таблица `Movie` уже должна быть заполнена!** Добавлет описание, ссылку на постер и дополнительные жанры в таблицу `Movie`. Сохраняет постеры локально. |
| *populate_logs*               | Имитирует действия пользователя на сайте. Необходимо для расчёта неявных оценок.                                                                                                                                                                                                     | Перезаписывает таблицу `UserEvent`. При необходимости добавляет пользователей.                                                                           |

### builders

Построители создают данные на основе исходных данных полученных от сидеров.

| Название                               | Описание                                                                                                                                                                   | Изменения в БД                                       |
| -------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------- |
| *calculate_implicit_ratings*           | Рассчитывает неявные оценки пользователей анализируя таблицу `UserEvent` . Оценки в диапазоне [0,10]. 0 оценки заменяются на 0.00001                                       | Перезаписывает все неявные оценки в таблице `Rating` |
| *calculate_implicit_ratings_timedecay* | Рассчитывает неявные оценки пользователей анализируя таблицу `UserEvent`. Учитывает временное затухание по дням. Оценки в диапазоне [0,10]. 0 оценки заменяются на 0.00001 | Перезаписывает все неявные оценки в таблице `Rating` |
| *similarity_movies_otiai*              | Расчёт сходства элементов (по явным и неявным оценкам пользователей) методом Отиаи                                                                                         | Перезаписывает `MovieSimilarity` с типом 'OTIAI'     |
| *similarity_users_otiai*               | Расчёт сходства пользователей (по явным и неявным оценкам пользователей) методом Отиаи                                                                                     | Перезаписывает `UserSimilarity` с типом 'OTIAI'      |

### recommenders

Рекомендаторы выдают рекомендации пользователю и предсказывает оценки пользователя, используя таблицы сходств и другие
данные

| Название                      | Описание                                                                                                            | Изменения в БД |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------- | -------------- |
| *popularity_recommender*      | Рекомендует фильмы с наибольшим количеством явных оценок, и с наибольшим числом покупок                             | Нет            |
| *cf_nb_item_item_recommender* | Collaborative Filtering, neighborhood-based, item-based. Рекомендует фильмы используя таблицу сходств фильмов       | Нет            |
| *cf_nb_user_user_recommender* | Collaborative Filtering, neighborhood-based, user-based. Рекомендует фильмы используя таблицу сходств пользователей | Нет            |

# TODO

1. Можно сохранять значение overlap при расчёте сходств
2. конспект 5.1 Коллизия при обновлении и получении правил из БД
3. https://github.com/prisma/prisma/issues/1938
4. GET sim/items/:movieId/:method ->views.similar_content ->lda_similarity

# Redis

- flushall - удалить все записи
- keys * - получить все коючи
- get key - прочитать значение ключа

## Параметры рекомендаторов

### similarity_movies_otiai
У Фалька используется косинусное сходство, у меня сходство Отиаи
| Параметр      | Описание                                                                                        | Мой тип | Значение у меня | Тип Фалька | Значение Фалька |
| ------------- | ----------------------------------------------------------------------------------------------- | :-----: | --------------: | :--------: | --------------: |
| *min_sims*    | Минимальное сходство элементов необходимое для их сохранения сходства в таблице                 |   *>*   |             0.05 |    *>*     |             0.0 |
| *min_overlap* | Количество пользователей оценивших ОБА фильма, необходимое для их сохранения сходства в таблице |   *>*   |               16 |    *>*     |              20 |

### cf_nb_item_item_recommender

| Параметр         | Описание                                                                                     | Мой тип | Значение у меня | Тип Фалька | Значение Фалька |
| ---------------- | -------------------------------------------------------------------------------------------- | :-----: | --------------: | :--------: | --------------: |
| *min_sims*       | Минимальное сходство элементов необходимое для извлекаемых записей из таблиц сходств         |   *>*   |             0.0 |    *>*     |             0.0 |
| *min_overlap*    | Минимальное количество фильмов пользователя для рекомендуемого элемента                      |  *>=*   |               2 |    *>=*     |               4 |
| *neighbors_size* | Максимальное количество фильмов пользователя для рекомендуемого элемента (больше отсекаются) |  *==*   |              15 |    *==*    |              15 |
| *ncandidates*    | Максимальное количество элементов извлекаемое из таблицы сходств для пользователя            |  *==*   |            1000 |    *==*    |             100 |

### similarity_users_otiai

| Параметр      | Описание                                                                                        | Мой тип | Значение у меня | Тип Фалька | Значение Фалька |
| ------------- | ----------------------------------------------------------------------------------------------- | :-----: | --------------: | :--------: | --------------: |
| *min_sims*    | Минимальное сходство элементов необходимое для их сохранения сходства в таблице                 |   *>*   |             0.2 |            |                 |
| *min_overlap* | Количество ОБЩИХ фильмов между пользователями, необходимое для их сохранения сходства в таблице |   *>*   |               2 |            |                 |

### cf_nb_user_user_recommender

| Параметр         | Описание                                                                                                                        | Мой тип | Значение у меня | Тип Фалька | Значение Фалька |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------- | :-----: | --------------: | :--------: | --------------: |
| *min_sims*       | Минимальное сходство пользователей необходимое для извлекаемых записей из таблиц сходств                                        |   *>*   |             0.2 |            |                 |
| *min_overlap*    | Минимальное количество схожих пользователей посмотревших рекомендуемый фильм                                                    |  *>=*   |               3 |            |                 |
| *neighbors_size* | Максимальное количество оценок схожик пользователей, которые помотрели рекомендуемый фильм (больше отсекаются) (не реализовано) |         |                 |            |                 |
| *ncandidates*    | Максимальное количество элементов исвлекаемое из таблицы сходств для пользователя                                               |  *==*   |             100 |            |                 |
